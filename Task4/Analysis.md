# Анализ узких мест миграции на микросервисную архитектуру

---

В ходе планируемой миграции компании с файлово-монолитной архитектуры (Excel/1C/FileServer) \
на микросервисную был проведен анализ рисков производительности. \
Переход от локального открытия файлов к сетевым взаимодействиям создает риск увеличения задержек (latency) и появления новых точек отказа.

**Главная проблема:** Риск низкой производительности и нестабильности новой системы после запуска.

---

## 1. Ключевые компоненты, затрагиваемые миграцией

В ходе миграции радикально меняется профиль нагрузки на следующие компоненты:

**Сетевая инфраструктура:** Переход от локальных вызовов (открытие файла с диска) к удаленным вызовам (RPC/REST). Сеть становится самым узким местом.
**Базы данных:** Переход от неструктурированных данных (Excel) и файловой 1С к реляционной СУБД (Postgres). Риски связаны с блокировками, индексами и качеством миграции данных.
**Слой интеграции:** Внедрение API Gateway и шины сообщений. Это новые точки отказа (SPOF), которых раньше не было.
**Безопасность:** Внедрение шифрования (TLS) и токенизации «на лету» требует дополнительных CPU-ресурсов.

---

## 2. Диаграмма Исикавы (Рыбья кость)

Диаграмма визуализирует причинно-следственные связи возможных проблем.
 ![Изображение](Isikava.png)



## 3. Описание выявленных проблем (Анализ категорий)

На основе диаграммы Исикавы выделены следующие группы рисков:

### 3.1. Архитектура и ПО
* **Сетевые задержки (Network Latency):** Самый критичный риск. В микросервисах запрос идет через API Gateway, балансировщик и сеть, что добавляет миллисекунды. При цепочке из 3-4 сервисов задержка становится заметной.
* **Chatty API (Болтливые интерфейсы):** Если фронтенд делает множество мелких запросов (N+1) для отображения одной страницы, система «захлебнется».
* **Накладные расходы на безопасность:** Шифрование каждого пакета (TLS) и токенизация PII потребляют CPU.

### 3.2. Инфраструктура
* **SPOF (Единая точка отказа):** Если упадет API Gateway или Keycloak (IAM), встанет вся клиника.
* **IOPS (Дисковая подсистема):** База данных Postgres требует высокой скорости диска. Медленные диски станут узким местом.

### 3.3. Данные и Интеграция
* **Качество данных (Dirty Data):** В Excel нет строгой типизации. При миграции в Postgres (где типы строгие) возможны ошибки конвертации.
* **Интеграция с 1С:** 1С часто работает медленно. Синхронное ожидание ответа от 1С может заблокировать интерфейс пользователя.

### 3.4. Персонал и Процессы
* **Bus Factor:** Текущий админ «умеет все». В новой архитектуре (K8s, Linux, Postgres) его знаний может не хватить.
* **Ручной деплой:** Попытка обновлять микросервисы вручную приведет к ошибкам конфигурации и простою (Downtime).

---

## 4. Рекомендации по устранению узких мест

Меры разделены по приоритетам (**P1** — критично, **P2** — важно, **P3** — желательно).

| Приоритет | Категория | Проблема | Рекомендация / Мера по устранению                                                                                             |
| :--- | :--- | :--- |:------------------------------------------------------------------------------------------------------------------------------|
| **P1** | Инфраструктура | Единая точка отказа (SPOF) | Развернуть High Availability (HA) кластер для API Gateway и Keycloak (минимум 2 инстанса).                                    |
| **P1** | Данные | Грязные данные из Excel | Написать скрипты валидации и очистки данных (ETL) до запуска новой системы. Провести тестовую миграцию.                       |
| **P1** | Персонал | Нехватка навыков | Организовать обучение администраторатехнологиям Docker/Postgres или нанять DevOps-инженера на аутсорс на этап запуска.        |
| **P2** | Архитектура | Сетевые задержки | Использовать асинхронное взаимодействие (RabbitMQ/Kafka) там, где не нужен мгновенный ответ (например, отправка данных в 1С). |
| **P2** | Данные | Медленные запросы (N+1) | Провести нагрузочное тестирование перед релизом (инструменты JMeter). Внедрить кэширование (Redis) для справочников.       |
| **P2** | Интеграция | Тормоза 1С | Реализовать паттерн Fallback: если 1С не отвечает, сохранять чек в очередь и пробивать позже, не блокируя работу кассира. |
| **P3** | Процессы | Ошибки деплоя | Внедрить CI/CD пайплайны (GitLab CI) для автоматического развертывания. Исключить ручной доступ на прод-сервера.          |
